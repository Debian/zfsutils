--- a/cddl/lib/libzfs/Makefile
+++ b/cddl/lib/libzfs/Makefile
@@ -8,7 +8,7 @@
 LIB=	zfs
 DPADD=	${LIBMD} ${LIBPTHREAD} ${LIBUMEM} ${LIBUTIL} ${LIBM} ${LIBNVPAIR} \
 	${LIBZFS_CORE}
-LDADD=	-lmd -lpthread -lumem -lzfs_core
+LDADD=	${.CURDIR}/../../../lib/libmd/libmd.a -lpthread -lumem -lzfs_core
 
 LDADD+= -lbsd -lm
 LDADD+= -L${.CURDIR}/../../../cddl/lib/libzfs_core
@@ -61,5 +61,6 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libuutil/common
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libzfs/common
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libzfs_core/common
+CFLAGS+= -I${.CURDIR}/../../../lib/libmd
 
 .include <bsd.lib.mk>
--- a/cddl/lib/libzpool/Makefile
+++ b/cddl/lib/libzpool/Makefile
@@ -57,12 +57,15 @@
 CFLAGS+=	-I${.CURDIR}/../../../lib/libthr/arch/${MACHINE_CPUARCH}/include
 
 DPADD=		${LIBMD} ${LIBPTHREAD} ${LIBZ}
-LDADD=		-lmd -lpthread -lz -lumem -lnvpair -lbsd -lrt
+LDADD=		     -lpthread -lz -lumem -lnvpair -lbsd -lrt
 
 LDADD+= -L${.CURDIR}/../../../cddl/lib/libumem
 LDADD+= -L${.CURDIR}/../../../cddl/lib/libnvpair
 LDADD+= ${.CURDIR}/../../../cddl/lib/libavl/libavl.a
 
+CFLAGS+= -I${.CURDIR}/../../../lib/libmd
+LDADD+= ${.CURDIR}/../../../lib/libmd/libmd.a
+
 # atomic.S doesn't like profiling.
 NO_PROFILE=
 
